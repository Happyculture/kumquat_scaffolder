<?php

/**
 * @file
 * Implementation of the {{ module }} module.
 */

use Drupal\media\IFrameMarkup;
use Drupal\{{ machine_name }}\Helpers\PatternsHelper;

/**
 * Implements hook_element_info_alter().
 */
function {{ machine_name }}_element_info_alter(array &$info) {
  if (!empty($info['pattern'])) {
    $info['pattern']['#pre_render'][] = [
      PatternsHelper::class,
      'handleOptionalFields',
    ];
    $info['pattern']['#pre_render'][] = [
      PatternsHelper::class,
      'handleMultipleFields',
    ];
    $info['pattern']['#pre_render'][] = [
      PatternsHelper::class,
      'handleBooleanFields',
    ];
  }
}

/**
 * Implements hook_preprocess_HOOK().
 *
 * Force Youtube videos to be played from the nocookie domain and Vimeo videos
 * to use the DNT attribute.
 */
function {{ machine_name }}_preprocess_media_oembed_iframe(&$variables) {
  if (strpos((string) $variables['media'], 'youtube.com') !== FALSE) {
    $variables['media'] = IFrameMarkup::create(str_replace('youtube.com/', 'youtube-nocookie.com/', $variables['media']));
  }
  elseif (strpos((string) $variables['media'], 'vimeo.com') !== FALSE) {
    $variables['media'] = IFrameMarkup::create(str_replace('?app_id=', '?dnt=1&app_id=', $variables['media']));
  }
}
